<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>eSIM QR Generator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background: #f5f5f5;
            min-height: 100vh;
        }
        textarea {
            width: 100%;
            max-width: 800px;
            min-height: 120px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            transition: border-color 0.3s ease;
            background: white;
            box-sizing: border-box;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        button {
            padding: 12px 24px;
            margin: 5px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        button:first-of-type {
            background: linear-gradient(135deg, #333, #666);
            color: white;
            border: none;
        }
        button:first-of-type:hover {
            background: linear-gradient(135deg, #222, #555);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        button:last-child {
            background: #f0f0f0;
            color: #888;
            border: 1px solid #999;
        }
        button:last-child:hover {
            background: #e8e8e8;
            color: #666;
            border: 1px solid #777;
        }
        .qr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .privacy-notice {
            background: linear-gradient(135deg, #333, #666);
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
            font-size: 14px;
            color: white;
            text-align: center;
        }
        .privacy-notice p {
            margin: 5px 0;
        }
        .download-link {
            color: #ddd;
            text-decoration: none;
            font-weight: 500;
        }
        .download-link:hover {
            color: white;
            text-decoration: underline;
        }
        .qr-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #333;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .qr-item {
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .qr-item:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .qr-item {
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .qr-item:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .qr-text {
            font-family: monospace;
            font-size: 11px;
            margin-top: 15px;
            word-break: break-all;
            color: #666;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            line-height: 1.4;
        }
        .install-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #333, #666);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .install-btn:hover {
            background: linear-gradient(135deg, #222, #555);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="privacy-notice">
        <p>本项目不收集任何 eSIM 激活码，所有处理均在浏览器本地完成</p>
        <p>如担心隐私泄漏，可 <a href="#" onclick="downloadPage()" class="download-link">点击下载</a> 后本地运行</p>
    </div>
    
    <h1 style="color: #333333; margin-bottom: 30px;">eSIM QR Code Generator</h1>
    <textarea id="codes" placeholder="输入激活码，每行一个"></textarea>
    <br>
    <button onclick="generate()">生成二维码</button>
    <button onclick="clearAll()">清空</button>
    
    <div id="qrContainer" class="qr-grid"></div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        function generate() {
            const input = document.getElementById('codes').value;
            const lines = input.split('\n').filter(line => line.trim());
            const container = document.getElementById('qrContainer');
            
            container.innerHTML = '';
            
            if (lines.length === 0) return;
            
            lines.forEach((line, index) => {
                const code = line.trim();
                if (!code) return;
                
                console.log('生成二维码内容:', code);
                
                const qrItem = document.createElement('div');
                qrItem.className = 'qr-item';
                
                const qrNumber = document.createElement('div');
                qrNumber.className = 'qr-number';
                qrNumber.textContent = index + 1;
                
                const qrDiv = document.createElement('div');
                qrDiv.id = 'qr-' + index;
                
                const textDiv = document.createElement('div');
                textDiv.className = 'qr-text';
                textDiv.textContent = code;
                
                const installBtn = document.createElement('button');
                installBtn.className = 'install-btn';
                installBtn.textContent = '直接安装 eSIM';
                installBtn.onclick = () => installESIM(code);
                
                qrItem.appendChild(qrNumber);
                qrItem.appendChild(qrDiv);
                qrItem.appendChild(textDiv);
                qrItem.appendChild(installBtn);
                container.appendChild(qrItem);
                
                new QRCode(qrDiv, {
                    text: code,
                    width: 200,
                    height: 200,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });
            });
        }
        
        function clearAll() {
            document.getElementById('codes').value = '';
            document.getElementById('qrContainer').innerHTML = '';
        }
        
        function downloadPage() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'esim-qr-generator.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function installESIM(code) {
            // 检测设备类型
            const userAgent = navigator.userAgent.toLowerCase();
            const isIOS = /iphone|ipad|ipod/.test(userAgent);
            const isAndroid = /android/.test(userAgent);
            
            if (isIOS) {
                // iOS 设备：使用苹果官方 eSIM 安装链接
                const encodedCode = encodeURIComponent(code);
                const appleURL = `https://esimsetup.apple.com/esim_qrcode_provisioning?carddata=${encodedCode}`;
                window.location.href = appleURL;
            } else if (isAndroid) {
                // Android 设备：复制到剪贴板并提供指引
                navigator.clipboard.writeText(code).then(() => {
                    alert('激活码已复制到剪贴板！\n请前往：设置 > 网络和互联网 > SIM 卡 > 添加 eSIM > 扫描运营商二维码 > 需要帮助？> 手动输入');
                }).catch(() => {
                    alert('请手动复制激活码：\n' + code + '\n\n然后前往：设置 > 网络和互联网 > SIM 卡 > 添加 eSIM');
                });
            } else {
                // 桌面设备：复制到剪贴板
                navigator.clipboard.writeText(code).then(() => {
                    alert('激活码已复制到剪贴板！\n请在支持 eSIM 的设备上使用此激活码。');
                }).catch(() => {
                    alert('请手动复制激活码：\n' + code);
                });
            }
        }
    </script>
</body>
</html>